
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Городской Транспорт — Ввод кода</title>
  <style>
    :root{
      --bg:#0e1620; --panel:#122029; --accent:#f5f7f9; --muted:#98a6b2;
      --kbd-bg:#e9eef2; --kbd-key:#ffffff; --kbd-border:#c7d2d9;
      font-family: Arial, Helvetica, sans-serif;
    }
    body{margin:0;background:linear-gradient(180deg,#0b1318,#0e1620);color:var(--accent);display:flex;align-items:center;justify-content:center;height:100vh}
    .card{width:360px;padding:20px;border-radius:8px;background:var(--panel);box-shadow:0 6px 18px rgba(0,0,0,.6)}
    .title{font-size:20px;margin-bottom:18px}
    .cells{display:flex;gap:8px;justify-content:center;margin-bottom:18px}
    .cell{width:36px;height:48px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:22px}
    .hint{display:flex;align-items:center;gap:8px;color:var(--muted);margin-bottom:12px}
    .kbd{background:var(--kbd-bg);padding:12px;border-radius:8px}
    .keys{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .key{background:var(--kbd-key);border:1px solid var(--kbd-border);height:56px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px;color:#111;cursor:pointer;user-select:none}
    .key:active{transform:translateY(1px)}
    .key.wide{grid-column:span 2}
    .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
    video{max-width:100%;border-radius:8px;margin-top:10px;display:none}
  </style>
</head>
<body>
  <div class="card" role="application" aria-label="Ввод кода">
    <div class="title">Городской Транспорт</div>

    <div class="cells" id="cells" aria-hidden="false">
      <div class="cell" data-index="0"></div>
      <div class="cell" data-index="1"></div>
      <div class="cell" data-index="2"></div>
      <div class="cell" data-index="3"></div>
      <div class="cell" data-index="4"></div>
      <div class="cell" data-index="5"></div>
    </div>

    <div class="hint">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 3h18v18H3z" fill="#98A6B2"/></svg>
      <div>Введите код с наклейки</div>
    </div>

    <div class="kbd" id="kbd" role="group" aria-label="Цифровая клавиатура">
      <div class="keys">
        <div class="key" data-key="1">1</div>
        <div class="key" data-key="2">2</div>
        <div class="key" data-key="3">3</div>
        <div class="key" data-key="4">4</div>
        <div class="key" data-key="5">5</div>
        <div class="key" data-key="6">6</div>
        <div class="key" data-key="7">7</div>
        <div class="key" data-key="8">8</div>
        <div class="key" data-key="9">9</div>
        <div class="key wide" id="scanBtn">Сканировать</div>
        <div class="key" data-key="0">0</div>
        <div class="key" id="sendBtn">✉️</div>
      </div>
      <video id="video" playsinline></video>
    </div>

    <div class="footer">@buspaybot</div>
  </div>

  <script>
    const MAX = 6
    const cells = document.querySelectorAll('.cell')
    let value = ''

    function refresh(){
      for(let i=0;i<MAX;i++){
        cells[i].textContent = value[i] ? value[i] : ''
      }
    }

    document.querySelectorAll('.key[data-key]').forEach(k=>{
      k.addEventListener('click', ()=>{
        if(value.length < MAX){
          value += k.dataset.key
          refresh()
        }
      })
    })

    // отправка (замените на реальную отправку в бота через Web App or API)
    document.getElementById('sendBtn').addEventListener('click', ()=>{
      if(value.length !== MAX){
        alert('Введите 6-значный код')
        return
      }
      // пример: window.Telegram.WebApp.sendData(value)
      console.log('Отправка кода:', value)
      alert('Код отправлен: ' + value)
      value = ''
      refresh()
    })

    // сканер QR (использует WebRTC + jsQR если подключите библиотеку)
    const video = document.getElementById('video')
    const scanBtn = document.getElementById('scanBtn')
    let stream=null, scanning=false, scanAnim=null

    scanBtn.addEventListener('click', async ()=>{
      if(!scanning){
        try{
          stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}})
          video.srcObject = stream
          await video.play()
          video.style.display = 'block'
          scanning = true
          scanFrame()
        }catch(e){
          alert('Ошибка доступа к камере: ' + e.message)
        }
      }else{
        stopScan()
      }
    })

    function stopScan(){
      if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null}
      video.pause(); video.style.display='none'; scanning=false
      if(scanAnim) cancelAnimationFrame(scanAnim)
    }

    // простая заглушка сканирования: пытается прочитать числовые символы через canvas + встроенный jsQR не подключён
    function scanFrame(){
      const canvas = document.createElement('canvas')
      const ctx = canvas.getContext('2d')
      canvas.width = video.videoWidth
      canvas.height = video.videoHeight
      ctx.drawImage(video,0,0,canvas.width,canvas.height)
      // Здесь можно подключить jsQR или другую библиотеку для распознавания QR и получить текст
      // Пример (если подключите jsQR): const code = jsQR(ctx.getImageData(0,0,canvas.width,canvas.height).data, canvas.width, canvas.height)
      // if(code){ handleScanned(code.data) }
      scanAnim = requestAnimationFrame(scanFrame)
    }

    function handleScanned(text){
      // если текст содержит 6 цифр подряд — заполняем
      const m = text.match(/(\d{6})/)
      if(m){
        value = m[1]
        refresh()
        stopScan()
        alert('Считан код: ' + value)
      }else{
        alert('QR не содержит 6-значного кода')
      }
    }

    // поддержка удаления по долгому нажатию правой кнопки и клавиатуры
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Backspace'){
        value = value.slice(0,-1)
        refresh()
      }
      if(/\d/.test(e.key)){
        if(value.length < MAX){ value += e.key; refresh() }
      }
    })
  </script>
</body>
</html>


